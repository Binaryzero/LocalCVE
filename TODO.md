# LocalCVE - TODO List

## Current Status
LocalCVE has basic CVE ingestion and viewing capabilities. Core infrastructure is complete. Git repository initialized, merged with remote, and PR #1 created for review.

## Completed Tasks
- ✓ Git-based CVE ingestion from cvelistV5 repository
- ✓ SQLite database with FTS5 full-text search
- ✓ React UI with CVE list view
- ✓ Backend API server with search and filtering
- ✓ Watchlist and alert database schema
- ✓ Created comprehensive CLAUDE.md file with architecture and development guide
- ✓ Initialized git repository (commit 43aa7e4)
- ✓ Updated .gitignore to exclude database files and CVE data
- ✓ Connected to GitHub remote (origin)
- ✓ Merged remote history with local code (commit da2ea2c)
- ✓ Created PR #1: Sync local updates to GitHub
- ✓ **Migrated to single-server architecture** for production (Jan 5, 2026)
- ✓ Server now serves both API and static files in production mode
- ✓ Maintained two-server dev mode for HMR functionality
- ✓ Updated package.json scripts (npm start for production)
- ✓ Created PRODUCTION.md usage guide
- ✓ Updated CLAUDE.md with new architecture details
- ✓ **All tests verified** (Jan 5, 2026)
- ✓ Fixed E2E tests to match actual UI elements
- ✓ Removed scanline effect from frontend
- ✓ Production build verified working (1.18s build time)
- ✓ **Fixed critical ingestion bugs** (Jan 5, 2026)
- ✓ Fixed "no changes" false positive by checking stored hash after git pull
- ✓ Fixed matcher.js null reference crash (defensive null checks)
- ✓ Ingestion now forces full scan when no stored hash exists
- ✓ Full scan triggered and running (136k+ CVEs processed, ongoing)
- ✓ Unit tests verified passing after fixes (1/1)
- ✓ **Fixed production mode serving** (Jan 5, 2026)
- ✓ Server now properly runs with NODE_ENV=production via npm start
- ✓ Serves built assets from dist/ instead of source files
- ✓ Application loads correctly in browser (no MIME type errors)
- ✓ **UI cleanup** (Jan 5, 2026)
- ✓ Removed fake status indicators (ONLINE, MONITORING, LIVE, OK)
- ✓ Removed Dashboard component with inaccurate statistics
- ✓ Removed "Local Mode" and "LocalCVE" branding references
- ✓ Changed app name to "CVE Tracker" throughout UI
- ✓ Threats page now the default landing page
- ✓ Bundle size reduced from 587KB to 241KB (60% reduction)
- ✓ All tests updated and passing (1/1 unit, 3/3 E2E)
- ✓ **Search-focused UI improvements** (Jan 5, 2026)
- ✓ Refactored Threats/CVE screen to search-first design (no default data display)
- ✓ Improved CVSS filter with dual input: slider (whole numbers) + text input (0.1 precision)
- ✓ Removed 100 alert limit from Alerts page
- ✓ Added KEV filtering support to alerts API
- ✓ Added "Mark all read" bulk action to Alerts page
- ✓ Added "Delete all" bulk action to Alerts page with confirmation
- ✓ All tests updated and passing (1/1 unit, 3/3 E2E)
- ✓ **Multi-Version CVSS Support & Enhanced Alert Generation** (Jan 6, 2026)
- ✓ Implemented multi-version CVSS collection (2.0, 3.0, 3.1)
- ✓ Enhanced alert generation with deduplication and error handling
- ✓ Added version-specific CVSS filtering to API and matcher
- ✓ Updated TypeScript types for all CVSS versions
- ✓ Created comprehensive unit tests for new functionality
- ✓ Created PR #2 with all changes
- ✓ All tests verified passing (5/5 unit, 3/3 E2E)
- ✓ **Security Compliance Review & Input Validation** (Jan 6, 2026)
- ✓ Conducted full audit against all 22 codeguard security rules
- ✓ Verified SQL injection protection (prepared statements throughout)
- ✓ Verified no hardcoded credentials in codebase
- ✓ Verified XSS protection (React auto-escaping, rel="noopener noreferrer")
- ✓ Verified cryptographic usage (SHA-256 correctly implemented)
- ✓ Implemented comprehensive input validation in server.js:
  - ✓ Request body size limit (1MB max)
  - ✓ Search parameter length limit (500 chars)
  - ✓ Limit parameter bounding (1-1000, default 100)
  - ✓ Offset validation (non-negative)
  - ✓ Severity enum validation (LOW/MEDIUM/HIGH/CRITICAL)
  - ✓ CVSS range validation (0-10)
  - ✓ Watchlist body structure validation (name, query required)
- ✓ All tests passing (5/5 unit)
- ✓ **Documentation Update** (Jan 6, 2026)
- ✓ Updated README.md with comprehensive project documentation
- ✓ Includes features, quick start, architecture, API reference, troubleshooting
- ✓ **UI Visual Refresh** (Jan 6, 2026)
- ✓ Changed background from dark teal (#0a0e1a) to pure black (#000000)
- ✓ Updated surface colors to neutral grays for cleaner look
- ✓ Softened cyan accent color for less visual noise
- ✓ Added accessibility focus states (visible outline on focus)
- ✓ Added prefers-reduced-motion support for accessibility
- ✓ Made grid pattern more subtle (nearly invisible)
- ✓ Slimmed scrollbar design for minimal appearance
- ✓ All E2E tests passing (3/3)
- ✓ **Ingestion System Overhaul** (Jan 6, 2026)
- ✓ Complete revamp of job management system:
  - ✓ Added job cancellation mechanism with cooperative cancellation checkpoints
  - ✓ Added persistent job logging (job_logs table with DB storage)
  - ✓ Added real-time log streaming via Server-Sent Events (SSE)
  - ✓ Added git operation timeouts (10min clone, 5min pull) with retry logic
  - ✓ Added stuck job auto-detection (marks jobs FAILED if no heartbeat for 10+ min)
  - ✓ Added detailed progress tracking (added/updated/unchanged counts)
  - ✓ Added progress percentage with responsive UI updates every 100 files
  - ✓ Migrated from execSync to spawnSync for safer git operations
- ✓ New database columns: progress_percent, items_added, items_updated, items_unchanged, current_phase, cancel_requested, last_heartbeat, total_files
- ✓ New API endpoints:
  - ✓ POST /api/jobs/:id/cancel - Request job cancellation
  - ✓ GET /api/jobs/:id/logs - Retrieve job logs
  - ✓ GET /api/jobs/:id/logs/stream - SSE streaming for real-time logs
- ✓ Enhanced Jobs.tsx UI:
  - ✓ Cancel button for running jobs
  - ✓ Progress bar with percentage
  - ✓ Change counts display (+added, ~updated, =unchanged)
  - ✓ Expandable log panel with real-time streaming
  - ✓ CANCELLED status badge support
- ✓ Build verified, unit tests passing (218/218)
- ✓ Fixed duplicate export error in nvd.js (registerSseClient/unregisterSseClient)
- ✓ Fixed getChangedFiles() to accept optional logger parameter
- ✓ Updated Playwright config for dual-server E2E tests
- ✓ E2E tests passing (3/3)
- ✓ **Ingestion Reliability & Health Monitoring** (Jan 7, 2026)
- ✓ Added server startup cleanup for orphaned RUNNING jobs
- ✓ Added `/api/health` endpoint for dataset completeness monitoring:
  - ✓ Shows CVE count vs repo file count
  - ✓ Calculates completeness percentage
  - ✓ Shows last commit hash from system_metadata
  - ✓ Shows last job status and any running job
- ✓ Cleaned up 90 orphaned RUNNING jobs from database
- ✓ Database currently 67% complete (217,825 / 326,434 CVEs)
- ✓ All tests passing (218 unit, 3 E2E)
- ✓ **API Responsiveness During Ingestion** (Jan 7, 2026)
- ✓ Added event loop yielding between batch inserts (setImmediate)
- ✓ API requests now processed between 2000-CVE batch commits
- ✓ Prevents server from becoming unresponsive during large ingestions
- ✓ **Static File Serving Improvements** (Jan 7, 2026)
- ✓ Added HEAD request support to static file handler
- ✓ Added Content-Length header to static file responses
- ✓ Fixed production mode serving from dist/ directory
- ✓ All tests passing (218 unit)
- ✓ **Advisory Language Removal** (Jan 7, 2026)
- ✓ Removed "Immediate action required" / "High priority remediation" / "Schedule remediation" / "Low priority" text from CvssVersionTabs
- ✓ Changed "monitor specific threats" to "track CVEs matching specific criteria" in Watchlists
- ✓ Changed "New vulnerability detected" to "New CVE match" in Alerts
- ✓ Changed "Vulnerability updated" to "CVE data updated" in Alerts
- ✓ App now provides data only, no prescriptive advice
- ✓ All tests passing (218 unit)
- ✓ **Phase 1 UI Enhancements** (Jan 6, 2026)
- ✓ Multi-Version CVSS Display:
  - ✓ Created CvssVersionTabs component with tabbed interface
  - ✓ Visual comparison chart using Recharts
  - ✓ CVSS vector string breakdown with tooltips
  - ✓ Severity-based color coding
- ✓ Date Range Filtering:
  - ✓ Added published_from/published_to API parameters
  - ✓ Native date input fields in filter panel
  - ✓ Quick presets (7D, 30D, 90D, YTD)
  - ✓ Clear dates button
- ✓ Filter Presets:
  - ✓ Created FilterPresets component
  - ✓ Built-in presets: Critical Only, High + Recent, Known Exploited
  - ✓ Custom preset saving to localStorage
  - ✓ Preset activation detection
- ✓ Virtual Scrolling:
  - ✓ Implemented @tanstack/react-virtual
  - ✓ Grid-based layout replacing table
  - ✓ 600px max height with virtualized rows
  - ✓ 72px estimated row height with 5 item overscan
- ✓ 218 unit tests passing, build verified
- ✓ **Phase 2 UI Enhancements** (Jan 6, 2026)
- ✓ Alert Management - Bulk Actions:
  - ✓ Checkbox column for individual alert selection
  - ✓ Select All / Deselect All in header
  - ✓ Selection toolbar with "Mark Selected Read" and "Delete Selected"
  - ✓ Three-state checkbox indicator (none/some/all)
- ✓ Alert Management - Grouping:
  - ✓ Group by Watchlist toggle
  - ✓ Group by Date toggle
  - ✓ Collapsible group sections with count badges
  - ✓ Unread count per group
- ✓ Alert Management - Export:
  - ✓ CSV export with CVE ID, Watchlist, Type, Date, Read columns
  - ✓ JSON export with full alert objects
  - ✓ Dropdown menu for format selection
- ✓ Watchlist Query Visualization:
  - ✓ Created QueryVisualizer component
  - ✓ Color-coded filter chips for each condition
  - ✓ Clickable chips to apply filter to CVE search
  - ✓ Human-readable query summary
- ✓ Severity Matrix Filter:
  - ✓ 4x3 grid (Critical/High/Medium/Low x CVSS 3.1/3.0/2.0)
  - ✓ Click cells for individual selection
  - ✓ Row/column header click for bulk selection
  - ✓ Selection counter badge
- ✓ 218 unit tests passing, build at 636KB
- ✓ **Watchlist UI Cleanup & CVE Filter Integration** (Jan 6, 2026)
- ✓ Audited Watchlists.tsx for unused/unwired elements
- ✓ Verified `enabled` toggle IS functional (filters alert generation)
- ✓ Verified `matchCount` IS updated during ingestion
- ✓ Removed dead "LAST RUN" display (never populated)
- ✓ Removed "Automated threat monitoring" marketing subtitle
- ✓ Simplified stats section to single "ALERTS GENERATED" row
- ✓ Added watchlist dropdown filter to CVE search page
  - ✓ Dropdown with all watchlists and alert counts
  - ✓ Selecting watchlist applies its query to filters
  - ✓ "ALL CVEs" option to clear watchlist filter
- ✓ Build verified (637KB)
- ✓ **Watchlist Edit & Rename** (Jan 6, 2026)
- ✓ Added inline name editing (click name to edit, Enter/Escape to save/cancel)
- ✓ Added query editor panel with all filter fields:
  - ✓ Search text
  - ✓ CVSS minimum score
  - ✓ KEV (Known Exploited) checkbox
  - ✓ Date range (from/to)
- ✓ Added `onUpdate` handler in App.tsx with optimistic UI updates
- ✓ Build verified (643KB)
- ✓ **Advanced Filtering: Vendors, Products, Status** (Jan 6, 2026)
- ✓ Added GET /api/vendors endpoint for typeahead search
  - ✓ Returns distinct vendors with CVE count
  - ✓ Supports query filtering and limit parameter
- ✓ Added GET /api/products endpoint for typeahead search
  - ✓ Returns distinct products with vendor and CVE count
  - ✓ Can filter by vendor for contextual suggestions
- ✓ Extended GET /api/cves with new filter parameters:
  - ✓ vendors: Comma-separated list with OR logic
  - ✓ products: Comma-separated list with OR logic
  - ✓ status: Filter by DISPUTED or REJECTED
- ✓ Created VendorProductFilter component:
  - ✓ Typeahead with 300ms debounce
  - ✓ Multi-select with removable chips
  - ✓ Loading indicators and dropdown UI
  - ✓ Distinct colors (cyan for vendors, purple for products)
- ✓ Added DISPUTED status toggle to filter panel
- ✓ Updated QueryModel types with vendors, products, status fields
- ✓ Updated App.tsx to pass new filters to API
- ✓ Added 20 new unit tests for endpoints
- ✓ 238 tests passing, 78% coverage
- ✓ Build verified (651KB)
- ✓ **Ingestion Performance Optimizations** (Jan 6, 2026)
- ✓ Added memory-mapped I/O (256MB mmap_size PRAGMA)
- ✓ Increased batch size from 2000 to 5000 CVEs per transaction
- ✓ Implemented bulk load mode (`POST /api/ingest/bulk`):
  - ✓ Disables foreign keys during bulk insert
  - ✓ Skips per-row FTS5 updates (rebuilds at end)
  - ✓ Skips alert generation during initial load
  - ✓ Skips change tracking for speed
- ✓ Added parallel file reading with Promise.all batching (10 concurrent reads)
- ✓ Added `rebuildFtsIndex()` for single-pass FTS5 rebuild
- ✓ Added "BULK (FAST)" button to Jobs UI
- ✓ 238 unit tests passing, 14 E2E tests passing
- ✓ Build verified (652KB)
- ✓ **CVE Detail Screen Improvements** (Jan 6, 2026)
- ✓ Added Affected Products section with vendor/product chips
  - ✓ Extended `/api/cves/:id` endpoint to include vendor/product data from configs table
  - ✓ Deduplicated vendor/product combinations in response
  - ✓ Styled with Building2/Package icons matching filter panel colors
- ✓ Removed redundant CVSS badge from header
  - ✓ Score shown once in CvssVersionTabs section (was shown in 2 places)
  - ✓ Added KEV badge to header for known exploited vulnerabilities
- ✓ Made Raw Data JSON section collapsible (default collapsed)
  - ✓ Click-to-expand disclosure pattern
  - ✓ Copy button only visible when expanded
- ✓ 238 unit tests passing
- ✓ Build verified (653KB)
- ✓ **CVE Detail Screen - Complete Data Extraction & Display** (Jan 6, 2026)
- ✓ Fixed CVSS duplication (removed individual fields, use only metrics array)
- ✓ Added new database tables:
  - ✓ `cve_cwes` - CWE classifications with descriptions
  - ✓ `cve_capec` - CAPEC attack patterns with descriptions
  - ✓ `cve_ssvc` - CISA SSVC prioritization scores
- ✓ Extended existing tables:
  - ✓ `cves` - Added title and source_advisory columns
  - ✓ `cve_references` - Added tags column (JSON array)
- ✓ Updated ingestion to extract:
  - ✓ CWE IDs from problemTypes
  - ✓ CAPEC IDs from impacts
  - ✓ SSVC scores (exploitation, automatable, technical_impact) from ADP containers
  - ✓ Reference tags (vendor-advisory, patch, exploit, etc.)
  - ✓ CVE title and source advisory ID
- ✓ Updated server /api/cves/:id endpoint:
  - ✓ Returns CWE, CAPEC, SSVC data
  - ✓ Returns references with tags
  - ✓ Returns change history
- ✓ Updated CveDetail.tsx with new sections:
  - ✓ Title display in header
  - ✓ CISA SSVC Prioritization section with color-coded badges
  - ✓ Problem Types (CWE) section with links to MITRE
  - ✓ Attack Patterns (CAPEC) section with links to MITRE
  - ✓ Enhanced References with colored tag badges
  - ✓ Source Advisory display
  - ✓ Change History (collapsible) with diff view
- ✓ Updated matcher.js to handle both old (string[]) and new ({url, tags}[]) reference formats
- ✓ All 241 tests passing, build verified (661KB)
- ✓ **CVE Detail Screen Enhancements - Phase 2** (Jan 7, 2026)
- ✓ Fixed change history date to use CVE's dateUpdated instead of system time
- ✓ UI reorganization:
  - ✓ DESCRIPTION section moved to top (front and center)
  - ✓ Removed redundant large CVSS score circle
  - ✓ Renamed "VULNERABILITY SEVERITY" to "Vulnerability details"
  - ✓ Moved KEV and SSVC indicators into CvssVersionTabs component (below chart, above vector breakdown)
  - ✓ Removed redundant SOURCE ADVISORY section (info already in REFERENCES with vendor-advisory tag)
- ✓ Made affected products clickable:
  - ✓ Vendor and product are separate clickable buttons
  - ✓ Clicking vendor filters CVE list to that vendor
  - ✓ Clicking product filters CVE list to that product
  - ✓ Added onApplyFilter prop to CveDetail component
- ✓ Added CISA KEV data integration:
  - ✓ Created fetchKevCatalog() helper to download KEV catalog during ingestion
  - ✓ Updated normalizeCve5() to accept kevSet parameter
  - ✓ CVEs in KEV catalog now have kev=true flag set
- ✓ Expanded affected products with version information:
  - ✓ Now stores defaultStatus, modules[], and versions[] for each affected product
  - ✓ Version entries include version, status, lessThan, lessThanOrEqual, versionType
  - ✓ Server endpoint returns full version data
  - ✓ CveDetail displays version ranges and modules with status indicators
- ✓ All 242 tests passing, build verified (661KB)
- ✓ **Workarounds & Solutions Extraction** (Jan 7, 2026)
- ✓ Added new database tables:
  - ✓ `cve_workarounds` - Mitigation guidance from CVE 5.0 cna.workarounds
  - ✓ `cve_solutions` - Official remediation from CVE 5.0 cna.solutions
- ✓ Updated ingestion to extract:
  - ✓ Workarounds (text + language) from cna.workarounds array
  - ✓ Solutions (text + language) from cna.solutions array
- ✓ Updated server /api/cves/:id endpoint to return workarounds and solutions
- ✓ Updated CveDetail.tsx with new sections:
  - ✓ WORKAROUNDS section (amber accent) with whitespace-preserving text
  - ✓ SOLUTIONS section (green accent) with whitespace-preserving text
- ✓ Added 4 new unit tests for workarounds/solutions extraction
- ✓ All 246 tests passing, build verified (662KB)
- ✓ **CVE Search & Filter Bug Fixes** (Jan 7, 2026)
- ✓ Fixed Bug #1: cvss_min=0 not sent to API (truthy check `if (filters.cvss_min)` fails when value is 0)
  - Changed to explicit null/undefined check in App.tsx
- ✓ Fixed Bug #2: KEV filter not sent to API (missing parameter)
  - Added `if (filters.kev) q.set('kev', 'true');` to App.tsx
- ✓ Fixed Bug #3: FTS5 search fails for CVE IDs like "CVE-2021"
  - FTS5 tokenizes on hyphens, so phrase query `"CVE-2021*"` didn't match
  - Changed to token AND matching: `CVE* AND 2021*`
- ✓ Fixed Bug #4: CVSS min=10 filter shows items below 10
  - UI displays MAX score across versions, but filter matched ANY version
  - Changed to `GROUP BY cve_id HAVING MAX(score) >= ?` for consistent behavior
- ✓ Removed VULNERABILITY STATUS filter (user requested cleanup)
  - Removed status field from QueryModel in types.ts
  - Removed status filter UI from CveList.tsx
  - Removed status parameter handling from App.tsx and server.js
- ✓ Updated server.test.ts to remove status-related test
- ✓ All 245 tests passing, build verified (661KB)
- ✓ **SQLite to DuckDB Migration** (Jan 8, 2026)
- ✓ Migrated database from SQLite (better-sqlite3) to DuckDB (@duckdb/node-api):
  - ✓ Created async DuckDB wrapper class with better-sqlite3-compatible API
  - ✓ Converted all synchronous queries to async/await patterns
  - ✓ Replaced SQLite FTS5 with DuckDB FTS extension
  - ✓ Converted JSON functions (json_each -> unnest, json_extract -> ->>)
  - ✓ Updated all prepared statements to use DuckDB parameter syntax ($1, $2)
  - ✓ Added connection refresh mechanism to handle DuckDB stability issues
  - ✓ Added query serialization to prevent concurrent access problems
  - ✓ Added retry-on-error with automatic connection refresh
- ✓ Successfully loaded 326,679 CVEs from /data/cvelistV5
- ✓ Database size: 1.6GB (DuckDB columnar format)
- ✓ API endpoints verified working with new database
- ✓ Unit tests: 109 passing (matcher.test.ts + nvd.test.ts)
- ✓ Note: server.test.ts has ESM compatibility issues with Jest (known limitation)
- ✓ **PR #4 Review Fixes** (Jan 8, 2026):
  - ✓ Added error logging to query queue catch block (was swallowing errors silently)
  - ✓ Added index on metrics.cve_id for query performance (critical for 326k+ CVEs)
  - ✓ Added parseErrors tracking to ingestion (counts failed file parses)
  - ✓ Documented FK constraint removal decision (intentional for bulk insert performance)
- ✓ **DuckDB to SQLite Reversion** (Jan 8, 2026):
  - ✓ Reverted from DuckDB to SQLite due to segfault crashes during ingestion
  - ✓ DuckDB instability issues with large datasets made it unreliable
  - ✓ SQLite with better-sqlite3 is rock-solid and synchronous
  - ✓ Optimized SQLite with bulk mode (synchronous=OFF, journal_mode=MEMORY)
  - ✓ Added 64MB cache size and 256MB memory-mapped I/O
  - ✓ Converted all async patterns back to sync better-sqlite3 API
  - ✓ Transaction wrapper uses manual BEGIN/COMMIT for async compatibility
- ✓ **ADP Metrics Extraction** (Jan 8, 2026):
  - ✓ Fixed CVSS scores showing N/A for CVEs like CVE-2021-45046
  - ✓ Root cause: Metrics only extracted from CNA containers, missing ADP-sourced scores
  - ✓ Added ADP metrics extraction loop to normalizeCve5() in nvd.js
  - ✓ Extracts CVSS 3.1, 3.0, 2.0 from all ADP containers (CISA-ADP, NVD, etc.)
  - ✓ Full re-ingestion updated 31,904 CVEs with ADP metrics
  - ✓ CVE-2021-45046 now shows: Score 9.0, CRITICAL, KEV: true (from CISA-ADP)
- ✓ **Search Parameter Fix** (Jan 8, 2026):
  - ✓ Fixed "Too few parameter values" error when searching
  - ✓ Root cause: Search query had two ? placeholders but only one parameter pushed
  - ✓ Fixed by pushing searchTerm twice for both `c.id LIKE ?` and `c.description LIKE ?`
- ✓ **KEV Filter Fix** (Jan 8, 2026):
  - ✓ Fixed KEV filter returning 0 results
  - ✓ SQLite json_extract returns integer 1 for boolean true, not string 'true'
  - ✓ Changed comparison from `= 'true' OR = '1'` to `= 1`
- ✓ **CVSS 4.0 Support** (Jan 8, 2026):
  - ✓ Added CVSS 4.0 extraction to normalizeCve5() in nvd.js (both CNA and ADP containers)
  - ✓ Added CVSS 4.0 vector component definitions to CvssVersionTabs.tsx
  - ✓ Updated parseVectorString to detect and parse CVSS 4.0 vectors
  - ✓ Added cvss40_min filtering to server.js API
  - ✓ Added cvss40Score/cvss40Severity to CVE list response
  - ✓ Updated SeverityMatrix to include CVSS 4.0 column
  - ✓ Full re-ingestion updated 16,473 CVEs with CVSS 4.0 metrics
  - ✓ Verified: CVE-2013-10054 shows 9.3 CRITICAL with CVSS 4.0 vector
- ✓ **Ingestion Log Message & Job Stats Fix** (Jan 8, 2026):
  - ✓ Fixed stale log message: "DuckDB FTS extension" → "FTS5 index rebuilt"
  - ✓ Fixed job completion stats not being written to database
  - ✓ Root cause: Final UPDATE query only wrote items_processed, not items_added/updated/unchanged
  - ✓ Added items_added, items_updated, items_unchanged to both COMPLETED and FAILED update queries
  - ✓ UI now shows accurate job statistics instead of all 0s
- ✓ **UX Improvements - Clear Filters & CVE Detail Navigation** (Jan 8, 2026):
  - ✓ Added "CLEAR" button to CVE search page (red, appears when filters active)
  - ✓ Clears all filters: text, CVSS, date range, vendors, products, KEV, matrix, watchlist
  - ✓ Fixed CVE detail view persisting when navigating away from CVE page
  - ✓ Created `handleNavigate()` that clears `selectedCveId` on page switch
  - ✓ `viewCve()` from alerts still works correctly (explicitly sets CVE ID)
- ✓ **CVSS Filter/Display - Version Priority** (Jan 8, 2026):
  - ✓ Changed from MAX score to version priority: 4.0 > 3.1 > 3.0 > 2.0
  - ✓ Root cause: MAX score often selected CVSS 2.0 which has "UNKNOWN" severity
  - ✓ Example: CVE-2025-15471 had CVSS 2.0=10.0 (UNKNOWN), CVSS 4.0=9.3 (CRITICAL)
  - ✓ Now displays 9.3 CRITICAL from 4.0 instead of "10 UNKNOWN" from 2.0
  - ✓ Filter logic also uses version priority to ensure consistency
  - ✓ Newer CVSS versions are more accurate and have proper severity labels
- ✓ **CVSS Duplicate Score Handling** (Jan 8, 2026):
  - ✓ Root cause: 279 CVEs have multiple scores for same CVSS version (CNA vs ADP assessments)
  - ✓ Example: CVE-2021-41277 had two CVSS 3.1 scores: 10.0 and 7.5
  - ✓ Display showed 7.5 but filter matched on 10.0 (inconsistent)
  - ✓ Fixed: Both display and filter now use MAX score per version
  - ✓ CVE-2021-41277 now shows 10 CRITICAL consistently
- ✓ **Data Grid Improvements** (Jan 8, 2026):
  - ✓ Fixed pagination showing when grid is blank (added cves.length > 0 && hasActiveSearch guard)
  - ✓ Fixed grid not filling available space (restructured with flex layout)
  - ✓ Fixed having to scroll up to access nav buttons (pagination now inside flex container)
  - ✓ Added server-side column sorting:
    - ✓ types.ts: Added sort_by and sort_order to QueryModel
    - ✓ server.js: Added sort parameter parsing and ORDER BY clause with SQL injection protection
    - ✓ App.tsx: Added sort state and handleSortChange handler
    - ✓ CveList.tsx: Added SortableHeader component with click-to-sort and direction indicators
  - ✓ Sortable columns: CVE ID (alphabetical), Severity (CVSS score with version priority), Published (date)
  - ✓ Sort direction toggles on click, shows up/down chevron indicator
  - ✓ Server-side sorting ensures consistent ordering across all pages
  - ✓ All 109 unit tests passing, build verified (667KB)
- ✓ **CVE Detail - Cleanup** (Jan 8, 2026):
  - ✓ Removed versionType and defaultStatus from affected products display
  - ✓ These technical values (maven, python, rpm, semver) aren't useful to end users
- ✓ **UI/UX Improvements** (Jan 8, 2026):
  - ✓ Grid now uses full width (removed max-w-7xl constraint from Layout.tsx)
  - ✓ Added missing watchlist edit options: modified date range, vendors, products
  - ✓ Added unread alerts badge to navigation (red badge with count, handles 99+ overflow)
  - ✓ Added "Recently Updated" filter with 24H/7D/30D presets (amber colored)
  - ✓ Server now supports modified_from/modified_to API parameters
  - ✓ All 109 unit tests passing, build verified (671KB)
- ✓ **UI Polish** (Jan 8, 2026):
  - ✓ Fixed duplicate badge on alerts nav item (badge only on icon when collapsed, only at end when expanded)
  - ✓ Removed pulse animation from active menu indicator
  - ✓ Made filter presets fully editable/removable (no more locked built-in presets)
  - ✓ Changed date presets to relative labels: "Today", "Last 7 Days", "Last 30 Days"
  - ✓ Combined published and modified date filters onto same row (side-by-side layout)
  - ✓ Modified date filter now works correctly (required server restart after previous changes)
  - ✓ All 109 unit tests passing, build verified (670KB)
- ✓ **Settings & Preferences** (Jan 8, 2026):
  - ✓ Created Settings menu with System nav section
  - ✓ Added option to hide rejected CVEs (filters on vuln_status='Rejected')
  - ✓ Added option to hide disputed CVEs (filters on vuln_status='Disputed')
  - ✓ Settings stored in localStorage with API pass-through (hide_rejected, hide_disputed params)
  - ✓ Restored active menu dot indicator (without pulse animation)
  - ✓ Added filter preset management to settings:
    - ✓ View all presets with name, icon, color, and query summary
    - ✓ Edit preset name, icon (5 options), and color (8 options)
    - ✓ Delete any preset (no more locked built-in presets)
    - ✓ Restore defaults button (Critical Only, High + Recent, Known Exploited)
    - ✓ Add new presets with custom name, icon, and color
  - ✓ Build verified (684KB)
- ✓ **Alert Improvements** (Jan 8, 2026):
  - ✓ Added mark as unread functionality (bell icon button, amber hover)
  - ✓ Added `/api/alerts/:id/unread` endpoint (PUT)
  - ✓ Watchlist rename now updates associated alert watchlistName (optimistic update)
- ✓ **Watchlist & Filter Improvements** (Jan 8, 2026):
  - ✓ Fixed date being added twice when saving watchlist ("Today" now sets single date, not range)
  - ✓ Added relative date support for watchlists:
    - ✓ Added published_relative and modified_relative fields to QueryModel
    - ✓ Date presets store both computed dates AND relative type ('today', 'last_7_days', 'last_30_days')
    - ✓ QueryVisualizer shows "Today" or "Last 7 Days" instead of absolute dates when using presets
    - ✓ Watchlists now persist dynamic date behavior
  - ✓ Added vendors and products display in QueryVisualizer
  - ✓ Removed CVSS slider (kept only text input)
  - ✓ Fixed modified date label color inconsistency (now matches published label color)
  - ✓ Build verified (685KB)
- ✓ **Bug Fixes & Improvements** (Jan 9, 2026):
  - ✓ Fixed mark unread for alerts (server restart required - new routes weren't loaded)
  - ✓ Fixed watchlist rename not updating alert names (added UPDATE alerts SQL in server.js)
  - ✓ Removed SeverityMatrix component (user found it confusing, removed from CveList.tsx)
  - ✓ Fixed restore defaults to not overwrite custom presets (now merges with existing)
  - ✓ Inverted hide rejected logic (default ON, toggle now says "Show Rejected CVEs")
  - ✓ Fixed hide rejected SQL filter (value is 'REJECTED' not 'Rejected')
  - ✓ Implemented truly dynamic relative dates for watchlists:
    - ✓ Added getDateRangeFromRelative() helper function to matcher.js
    - ✓ Matcher now prefers published_relative/modified_relative over absolute dates
    - ✓ Server.js converts relative params to absolute at query time
    - ✓ App.tsx sends relative params when available
    - ✓ Watchlists with "Last 7 Days" now always mean 7 days from TODAY
  - ✓ Fixed filter preset colors/icons not syncing to CVE screen:
    - ✓ FilterPresets.tsx now listens for 'presets-updated' custom event
    - ✓ Settings.tsx dispatches event when presets change
    - ✓ FilterPresets now renders colors and icons (was showing names only)
    - ✓ DEFAULT_PRESETS aligned between Settings.tsx and FilterPresets.tsx
  - ✓ All 117 tests passing, build verified (680KB)
- ✓ **Browser Testing Verification** (Jan 9, 2026):
  - ✓ All fixes verified working in Chrome browser at http://127.0.0.1:17920
  - ✓ Filter presets show correct colors/icons (red, amber, purple)
  - ✓ Severity Matrix button confirmed removed from UI
  - ✓ "Show Rejected CVEs" checkbox displays correctly (inverted logic)
  - ✓ Dynamic relative dates: "Last 7 Days" auto-populates date fields
  - ✓ "Restore Defaults" preserves custom presets (tested with "My Test Preset")
  - ✓ Custom presets sync in real-time between Settings and CVE screen
  - ✓ 389,831 results returned for "apache" search with filters
- ✓ **Additional UI Fixes** (Jan 9, 2026):
  - ✓ Added "Today" filter preset (green, calendar icon) - dynamic, always means today
  - ✓ Fixed date filters not triggering search (hasActiveSearch now includes published_relative and modified_relative)
  - ✓ Fixed alert watchlist name sync (already works - tested via API, existing data was stale)
  - ✓ Added bulk "Mark All Unread" button to alerts (amber, bell icon)
  - ✓ Added `/api/alerts/mark-all-unread` endpoint
  - ✓ Shrunk CVSS score input (w-full -> w-20, 80px wide)
  - ✓ Added dual pagination (controls at top AND bottom of CVE grid)
  - ✓ Bottom pagination scrolls grid to top when used (smooth scroll)
  - ✓ All 117 unit tests passing, build verified (682KB)
- ✓ **Preset Query Editing & Clear Filter Improvements** (Jan 9, 2026):
  - ✓ Added full query editor to Settings preset management:
    - ✓ Search Text input field
    - ✓ Min CVSS number input (0-10)
    - ✓ Date Filter dropdown (Today, Last 7/30/90 Days)
    - ✓ KEV Only checkbox
  - ✓ Added "CLEAR FILTERS" button to no-results empty state:
    - ✓ Button appears directly in "NO RESULTS MATCH YOUR SEARCH" message
    - ✓ Provides obvious escape path when filters return zero results
    - ✓ Clears all filters: text, CVSS, dates, vendors, products, KEV
  - ✓ All 117 unit tests passing, build verified (685KB)
- ✓ **Additional UI/UX Fixes** (Jan 9, 2026):
  - ✓ Added missing filter options to preset editor in Settings:
    - ✓ Modified date filter dropdown (matches Published filter)
    - ✓ Vendors input (comma-separated list)
    - ✓ Products input (comma-separated list)
  - ✓ Fixed alert badge overlapping bell icon when sidebar collapsed:
    - ✓ Repositioned badge further right (-right-3) and up (-top-2)
    - ✓ Made badge smaller (16x16px, 9px font)
    - ✓ Added black border for better visibility
  - ✓ Fixed reference links in CVE list grid:
    - ✓ Bug: `cve.references[0]` was object `{url,tags}` not string
    - ✓ Fix: Now extracts `.url` property for href
  - ✓ Verified workarounds/solutions display:
    - ✓ Database has 3,261 workarounds and 16,026 solutions
    - ✓ UI sections render correctly when data exists
    - ✓ Most CVEs don't have this data (it's optional in CVE 5.0 schema)
  - ✓ All 117 unit tests passing, build verified (686KB)
- ✓ **CVSS-BT & Trickest Job Logging** (Jan 9, 2026):
  - ✓ Fixed CVSS-BT and Trickest ingestion not appearing in job logs
  - ✓ Refactored both modules to use JobLogger and job_runs table like NVD ingestion
  - ✓ Created new `run()` functions that return jobId for background tracking
  - ✓ Updated server endpoints to return HTTP 202 with jobId
  - ✓ Both jobs now show progress, phase, item counts in Jobs UI
  - ✓ Added legacy function wrappers for backwards compatibility
- ✓ **CVE Detail Exploit Section Improvements** (Jan 9, 2026):
  - ✓ Fixed badge-to-exploit source mismatch:
    - ✓ Badges now driven by actual exploit data, not CVSS-BT boolean flags
    - ✓ Added counts to badges (e.g., "GitHub (15)")
    - ✓ Clicking badge scrolls to corresponding section
  - ✓ Added missing CISA and HackerOne exploit sections
  - ✓ Added scroll indicators to exploit lists:
    - ✓ Created reusable ScrollableList component
    - ✓ Shows gradient fade at bottom when more content exists
    - ✓ Animated chevron hint for scrollability
    - ✓ Top fade appears when scrolled down
    - ✓ Auto-detects if content is scrollable (threshold: 5 items)
  - ✓ All 48 matcher tests passing, build verified (365KB)
- ✓ **CVE Navigation Improvements** (Jan 9, 2026):
  - ✓ Made REFERENCES section collapsible (matches other sections)
  - ✓ Added Prev/Next CVE navigation buttons to detail view:
    - ✓ Navigate between CVEs without returning to list
    - ✓ Keyboard shortcuts: Arrow Left/Right, J/K (vim-style), Escape to return
    - ✓ Position indicator shows "5 / 100" format
  - ✓ Added sticky list position on back navigation:
    - ✓ Scroll position saved when clicking CVE row
    - ✓ Position restored when returning from detail view
    - ✓ Last-viewed CVE highlighted with cyan pulse animation (1.5s fade)
  - ✓ Implemented split pane layout option:
    - ✓ Toggle button in header (Columns/LayoutList icons)
    - ✓ Layout mode persisted to localStorage
    - ✓ Left panel: Compact CVE list (420px) with simplified columns (ID + CVSS only)
    - ✓ Right panel: Full CVE detail view or placeholder prompt
    - ✓ Selected CVE highlighted with cyan left border
    - ✓ Filter presets, watchlist dropdown, advanced filters hidden in split mode
    - ✓ Back button hidden in split mode (just click another CVE)
  - ✓ Build verified (372KB)

## Critical Missing Features

### Alert Generation Logic
- ✓ Implement watchlist matching in ingestion process
- ✓ Generate alerts table entries when CVEs match watchlist queries
- ✓ Add alert matching to `processBatch` transaction in src/lib/ingest/nvd.js
- ✓ Test alert generation with sample watchlists
- ✓ Enhance alert generation with deduplication and error handling
- ✓ Add watchlist match count tracking

### CVSS-BT Enrichment (PRIMARY - includes EPSS) - COMPLETED (Jan 9, 2026)
Source: https://github.com/t0sche/cvss-bt
Daily updated CSV with temporal CVSS scores, EPSS, and exploit maturity from multiple threat intel sources.

**Data Lineage (Verified):**
- CISA KEV (US Government) - Authoritative
- EPSS/FIRST.org (Industry standard, 200+ members) - Authoritative
- NVD/NIST (US Government) - Authoritative
- Metasploit/Rapid7 (Public company) - Highly credible
- VulnCheck KEV (Commercial) - Credible
- Nuclei/ProjectDiscovery (Open source, 11k+ templates) - Credible
- ExploitDB/OffSec (Kali maintainers) - Highly credible

- ✓ Created `cve_temporal` table for enrichment data (db.js)
- ✓ Created ingestion module (`src/lib/ingest/cvssbt.js`):
  - ✓ Downloads CSV from GitHub with streaming parser
  - ✓ Extracts EPSS score, exploit maturity, CVSS-BT score/severity
  - ✓ Extracts source indicators: CISA KEV, VulnCheck KEV, Metasploit, Nuclei, ExploitDB, GitHub PoC
  - ✓ Batch upserts to cve_temporal table (5000 per transaction)
- ✓ Added `POST /api/ingest/cvss-bt` endpoint for manual sync
- ✓ Extended `/api/cves/:id` endpoint to return temporal enrichment data
- ✓ Added "SYNC CVSS-BT" button to Jobs UI (purple theme, Zap icon)
- ✓ Display in CVE detail (CveDetail.tsx):
  - ✓ EPSS score with percentage display
  - ✓ Exploit Maturity badge (color-coded: red=Attacked, orange=High, yellow=Functional, cyan=PoC, gray=Unproven)
  - ✓ CVSS-BT adjusted score
  - ✓ Exploit source indicators (CISA KEV, VulnCheck KEV, Metasploit, Nuclei, ExploitDB, GitHub PoC)
- ✓ Added filters to CVE search (CveList.tsx):
  - ✓ MIN EPSS % input (0-100, stored as 0-1)
  - ✓ Exploit Maturity dropdown (Attacked/High/Functional/PoC/Unproven)
- ✓ Updated types.ts with exploit_maturity filter option
- ✓ Build verified (352KB bundle)

### Trickest CVE PoC Links (COMPLETED - Jan 9, 2026)
Source: https://github.com/trickest/cve
Direct links to exploit code repositories and security advisories.

**Data Lineage (Verified):**
- CVEProject/cvelist (MITRE) - Authoritative
- HackerOne disclosed reports - Highly credible
- GitHub PoC repositories - Community sourced (unvetted)

- [x] Clone/pull trickest/cve repository
- [x] Parse markdown files to extract:
  - [x] GitHub exploit repository URLs
  - [x] PoC reference links (advisories, analyses)
- [x] Create `cve_exploits` table for exploit links
- [x] Update CVE detail with collapsible "EXPLOIT REFERENCES" section
- [x] Add "SYNC TRICKEST" button to Jobs UI
- [ ] Schedule periodic sync (optional future enhancement)

## UI Improvements

### Pagination (COMPLETED)
- ✓ Server-side pagination implemented for /api/cves endpoint
- ✓ Page navigation controls added to CveList component
- ✓ Total count and page state handled in frontend

### CVE Detail View (COMPLETED)
- ✓ Detailed CVE component created
- ✓ Shows full JSON data and all metadata
- ✓ Displays references, configurations, and change history
- ✓ Click handler added to CVE list items

## Backend Enhancements

### Advanced Filtering
- ✓ Expose FTS5 search via API query parameters
- ✓ Add CVSS score range filtering (min/max)
- ✓ Update frontend to use server-side search/filtering
- ✓ Add KEV filtering support to alerts
- ✓ Add multi-version CVSS filtering support (cvss2_min, cvss30_min, cvss31_min)
- ✓ Add date range filtering (published_from, published_to)
- ✓ Add filtering by vendors, products (Jan 6, 2026)
- ✓ Add filtering by vulnerability status (DISPUTED)

## Testing & Quality

### Test Coverage
- ✓ Write unit tests for matcher.js watchlist logic
- ✓ Add unit tests for multi-version CVSS support
- ✓ Add E2E tests for CVE search and filtering (14 tests)
- ✓ Test alert generation workflow
- ✓ Add tests for ingestion edge cases
- ✓ **Comprehensive Unit Test Suite** (Jan 6, 2026)
  - ✓ 213 total tests across 4 test files
  - ✓ 85.97% statement coverage (527/613)
  - ✓ 87.76% branch coverage (251/286)
  - ✓ matcher.js: 100% coverage
  - ✓ server.js: 95.05% coverage
  - ✓ db.js: 78.26% coverage (schema migration code excluded)
  - ✓ nvd.js: 73.12% coverage (git/file operations excluded)
  - ✓ All configured per-file thresholds passing
  - ✓ Added server.test.ts with comprehensive API endpoint tests
  - ✓ Added processBatch tests for CVE ingestion
  - ✓ Added CVSS version-specific tests (2.0, 3.0, 3.1)
  - ✓ Added alert generation and deduplication tests
  - ✓ Added FTS5 search operation tests

## Security Compliance

### CodeGuard Security Review (Jan 9, 2026) - COMPLETED
Full audit against 22 CodeGuard instruction files:

**COMPLIANT:**
- Input validation and injection prevention (SQL parameterization, FTS5 escaping, body size limits)
- OS command injection (git commands use hardcoded URLs, spawnSync with structured args)
- Path traversal protection (path.resolve + directory containment check)
- Rate limiting (200 req/min per IP)
- Security headers (CSP, X-Frame-Options, X-Content-Type-Options, Referrer-Policy, Permissions-Policy)
- XSS protection (React auto-escaping, no raw HTML insertion)
- Cryptography (SHA-256 correctly implemented)
- No hardcoded credentials in source
- Supply chain (package-lock.json and bun.lock present)
- Error handling (does not leak sensitive info)
- Logging (structured, sanitized)

**FIXED:**
- Removed API key exposure from vite.config.ts (was exposing GEMINI_API_KEY to client bundle)
- Changed dev server host from 0.0.0.0 to localhost (prevents LAN exposure)
- Added security comments for CDN usage (documented dev-only pattern)

**ACCEPTABLE FOR LOCAL-FIRST APP:**
- CORS set to '*' (server only listens on 127.0.0.1)
- No authentication (local-first single-user app)
- CDN scripts in dev mode (production build is self-contained)

## Documentation
- [ ] Document watchlist query syntax
- ✓ Add API endpoint documentation (in README.md)
- [ ] Create user guide for alert setup
